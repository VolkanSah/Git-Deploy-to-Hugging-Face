name: Secure HF Deployment
on:
  release:
    types: [created]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Setup Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          # Hugging Face spezifische Authentifizierung
          git config --global credential.helper store
          echo "https://hf_user:${{ secrets.HF_API_TOKEN }}@huggingface.co" > ~/.git-credentials
      
      - name: Push to Hugging Face
        run: |
          git remote add hf https://huggingface.co/spaces/Alibrown/Git-Deploy-to-Hugging-Face
          
          # Force-Push mit automatischem Token-Handling
          git push hf HEAD:main --force-with-lease 2>&1 | tee push.log
          
          # Token masking f√ºr Sicherheit
          sed -i "s/${{ secrets.HF_API_TOKEN }}/******/g" push.log
          cat push.log
      
      - name: Verify Token Usage
        run: |
          if grep -q "Authentication failed" push.log; then
            echo "::error::Invalid HF Token! Check permissions and validity."
            exit 1
          fi
